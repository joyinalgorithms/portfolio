{% extends "general_layout.html" %}
{% block title %}Runoff{% endblock %}
{% block stylesheet %}
    <link rel="stylesheet" href="/static/styles/cs50/runoff.css">{% endblock %}
{% block body %}
    <div class="container">
        <div class="voting-card">
            <h1 class="title">ğŸ† Runoff Voting</h1>
            <p class="subtitle">Ranked choice voting with instant runoff elimination</p>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div class="step-indicator">
                <div class="step active" id="step1">
                    <div class="step-number">1</div>
                    <div class="step-label">Setup Candidates</div>
                </div>
                <div class="step" id="step2">
                    <div class="step-number">2</div>
                    <div class="step-label">Set Voters</div>
                </div>
                <div class="step" id="step3">
                    <div class="step-number">3</div>
                    <div class="step-label">Ranking</div>
                </div>
                <div class="step" id="step4">
                    <div class="step-number">4</div>
                    <div class="step-label">Runoff Rounds</div>
                </div>
                <div class="step" id="step5">
                    <div class="step-number">5</div>
                    <div class="step-label">Results</div>
                </div>
            </div>

            <div class="section active" id="section1">
                <div class="input-group">
                    <label class="input-label" for="candidateInput">Add Candidate (Maximum 9)</label>
                    <input type="text" id="candidateInput" class="input-field" placeholder="Enter candidate name..." maxlength="50">
                    <div class="validation-message" id="candidateValidation"></div>
                </div>

                <button class="btn" id="addCandidateBtn" onclick="addCandidate()">
                    â• Add Candidate
                </button>

                <div class="candidate-list" id="candidateList"></div>

                <button class="btn" id="nextToVotersBtn" onclick="nextStep()" disabled>
                    Next: Set Voters â†’
                </button>
            </div>

            <div class="section" id="section2">
                <div class="input-group">
                    <label class="input-label" for="voterCountInput">Number of Voters (Maximum 100)</label>
                    <input type="number" id="voterCountInput" class="input-field" placeholder="Enter number of voters..." min="1" max="100">
                    <div class="validation-message" id="voterValidation"></div>
                </div>

                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="btn btn-secondary" onclick="previousStep()">
                        â† Back
                    </button>
                    <button class="btn" id="startRankingBtn" onclick="startRanking()" disabled>
                        Start Ranking â†’
                    </button>
                </div>
            </div>

            <div class="section" id="section3">
                <div class="voter-info" id="voterInfo">
                    <div class="voter-number" id="currentVoterNumber">1</div>
                    <div class="voter-label">Current Voter</div>
                </div>

                <div class="ranking-container">
                    <div class="ranking-title">Rank Candidates by Preference</div>
                    <div class="ranking-instructions">
                        Drag and drop to reorder candidates from most preferred (1st) to least preferred
                    </div>

                    <div class="ranking-list" id="rankingList"></div>
                </div>

                <div class="validation-message" id="rankingValidation"></div>

                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="btn btn-secondary" onclick="previousStep()">
                        â† Back
                    </button>
                    <button class="btn" id="submitRankingBtn" onclick="submitRanking()">
                        Submit Ranking
                    </button>
                </div>
            </div>

            <div class="section" id="section4">
                <div id="roundsContainer"></div>

                <div style="text-align: center;">
                    <button class="btn" id="nextRoundBtn" onclick="nextRound()" style="display: none;">
                        Next Round â†’
                    </button>
                    <button class="btn btn-success" id="showFinalResultsBtn" onclick="showFinalResults()" style="display: none;">
                        Show Final Results â†’
                    </button>
                </div>
            </div>
            <div class="section" id="section5">
                <div id="finalResultsContainer"></div>

                <button class="btn btn-success" onclick="resetElection()">
                    ğŸ”„ New Election
                </button>
            </div>
        </div>
    </div>
    {% block scripts %}<script src="/static/scripts/cs50/runoff.js"></script>{% endblock %}
{% endblock %}
